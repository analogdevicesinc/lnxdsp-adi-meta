From 51c2ef950ed74a8b2b5a4699bc0abe55c84e2c7e Mon Sep 17 00:00:00 2001
From: Utsav Agarwal <utsav.agarwal@analog.com>
Date: Wed, 8 Jan 2025 18:19:48 +0000
Subject: [PATCH] Disabling peripherals for a faster falcon boot

Signed-off-by: Utsav Agarwal <utsav.agarwal@analog.com>
---
 arch/arm64/boot/dts/adi/sc598-som-ezkit.dts  |   4 +-
 arch/arm64/boot/dts/adi/sc598-som.dtsi       |  14 +-
 arch/arm64/boot/dts/adi/sc59x-64.dtsi        |  16 +-
 arch/arm64/configs/sc598-som-ezkit_defconfig | 202 +------------------
 4 files changed, 23 insertions(+), 213 deletions(-)

diff --git a/arch/arm64/boot/dts/adi/sc598-som-ezkit.dts b/arch/arm64/boot/dts/adi/sc598-som-ezkit.dts
index 96287238f741..536c72f2ab6a 100644
--- a/arch/arm64/boot/dts/adi/sc598-som-ezkit.dts
+++ b/arch/arm64/boot/dts/adi/sc598-som-ezkit.dts
@@ -306,12 +306,12 @@ route {
 };
 
 &pkte1 {
-	status = "okay";
+	status = "disabled";
 	mode = "arm";        /* autonomous ring mode */
 	/* mode = "tcm"; */  /* target command mode  */
 	/* mode = "dhm"; */  /* direct host mode     */
 };
 
 &crc0 {
-	status = "okay";
+	status = "disabled";
 };
diff --git a/arch/arm64/boot/dts/adi/sc598-som.dtsi b/arch/arm64/boot/dts/adi/sc598-som.dtsi
index 92749e6cf9eb..35bbbe52bc16 100644
--- a/arch/arm64/boot/dts/adi/sc598-som.dtsi
+++ b/arch/arm64/boot/dts/adi/sc598-som.dtsi
@@ -78,7 +78,7 @@ sharc0: core1-rproc@0x28240000 {
 			adi,verify = <1>;
 			adi,tru = <&tru>;
 			adi,tru-master-id = <135>; /* trigger master SOFT4 */
-			status = "okay";
+			status = "disabled";
 		};
 
 		sharc1: core2-rproc@0x28a40000 {
@@ -96,7 +96,7 @@ sharc1: core2-rproc@0x28a40000 {
 			adi,verify = <1>;
 			adi,tru = <&tru>;
 			adi,tru-master-id = <136>; /* trigger master SOFT5 */
-			status = "okay";
+			status = "disabled";
 		};
 
 		sharc0_rpmsg: core0-rpmsg@0x28240000 {
@@ -146,7 +146,7 @@ rpmsg_to_sharc1: channel@2 {
 };
 
 &thermal {
-	status = "okay";
+	status = "disabled";
 	adi,trip-alert = <60>;
 	adi,trip-fault = <85>;
 	/* adi,average; */
@@ -201,7 +201,7 @@ spidev@0 {
 &spi2 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&spi2_quad>;
-	status = "okay";
+	status = "disabled";
 	cs-gpios = <&gpa 5 GPIO_ACTIVE_LOW>;
 
 	flash: is25lp512@0 {
@@ -342,19 +342,19 @@ &mmc0{
 	bus-width = <8>;
 	max-frequency = <50000000>;
 	non-removable;
-	status = "okay";
+	status = "disabled";
 };
 
 &usb0_phy {
 	reset-gpios = <&gpg 11 GPIO_ACTIVE_LOW>;
-	status = "okay";
+	status = "disabled";
 };
 
 &usb0 {
 	dr_mode = "host";
 	pinctrl-names = "default";
 	pinctrl-0 = <&usbc0_default>;
-	status = "okay";
+	status = "disabled";
 };
 
 &pinctrl0 {
diff --git a/arch/arm64/boot/dts/adi/sc59x-64.dtsi b/arch/arm64/boot/dts/adi/sc59x-64.dtsi
index 40e9071240b3..a0b26e2bdf6d 100644
--- a/arch/arm64/boot/dts/adi/sc59x-64.dtsi
+++ b/arch/arm64/boot/dts/adi/sc59x-64.dtsi
@@ -229,7 +229,7 @@ sram-controller@31080000 {
 
 		gptimer_counter: gptimer-counters@0 {
 			compatible = "adi,gptimer-counter";
-			status = "okay";
+			status = "disabled";
 		};
 
 		rcu: rcu@0x3108c000 {
@@ -246,7 +246,7 @@ sec: sec@0x31089000 {
 			reg = <0x31089000 0x1000>;
 			adi,rcu = <&rcu>;
 			adi,sharc-cores = <2>;
-			status = "okay";
+			status = "disabled";
 		};
 
 		tru: tru@0x3108a000 {
@@ -254,7 +254,7 @@ tru: tru@0x3108a000 {
 			reg = <0x3108a000 0x1000>;
 			adi,max-master-id = <182>;
 			adi,max-slave-id = <187>;
-			status = "okay";
+			status = "disabled";
 		};
 
 		thermal: thermal@0x31016800 {
@@ -275,7 +275,7 @@ hadc: hadc@0x31016000 {
 			interrupt-parent = <&gic>;
 			interrupts = <GIC_SPI 186 IRQ_TYPE_EDGE_RISING>;
 			#iio-cells = <1>;
-			status = "okay";
+			status = "disabled";
 		};
 
 		rtc0: rtc@0x310C8000 {
@@ -1116,7 +1116,7 @@ sport4b: channel@11 {
 		spi_cluster: dma@0x3102d000 {
 			compatible = "adi,dma-controller";
 			reg = <0x3102d000 0x1000>;
-			status = "okay";
+			status = "disabled";
 			#dma-cells = <1>;
 
 			spi0_tx: channel@22 {
@@ -1188,7 +1188,7 @@ spi3_rx: channel@56 {
 		crc_cluster: dma@0x310a7000 {
 			compatible = "adi,dma-controller";
 			reg = <0x310a7000 0x1000>;
-			status = "okay";
+			status = "disabled";
 			#dma-cells = <1>;
 
 			crc0_dma: channel@8 { /* MDMA0_SRC */
@@ -1211,7 +1211,7 @@ crc1_dma: channel@18 { /* MDMA1_SRC */
 		dma_cluster2: dma@0x31026000 {
 			compatible = "adi,dma-controller";
 			reg = <0x31026000 0x1000>;
-			status = "okay";
+			status = "disabled";
 			#dma-cells = <1>;
 
 			uart0_tx: channel@20 {
@@ -1308,7 +1308,7 @@ trng: rng@0x310D0000 {
 			alarm-thresh  = <0xff>;
 			shdn-thresh = <0x04>;
 			poll-data = <0>; /* Use IRQ for data */
-			status = "okay";
+			status = "disabled";
 		};
 
 	};
diff --git a/arch/arm64/configs/sc598-som-ezkit_defconfig b/arch/arm64/configs/sc598-som-ezkit_defconfig
index b7ea7bab5dcb..7bb2a1c93ca6 100644
--- a/arch/arm64/configs/sc598-som-ezkit_defconfig
+++ b/arch/arm64/configs/sc598-som-ezkit_defconfig
@@ -1,4 +1,4 @@
-CONFIG_LOCALVERSION="-yocto-standard"
+CONFIG_LOCALVERSION="-yocto-falcon"
 CONFIG_SYSVIPC=y
 CONFIG_POSIX_MQUEUE=y
 CONFIG_AUDIT=y
@@ -78,15 +78,15 @@ CONFIG_ACPI_APEI_GHES=y
 CONFIG_ACPI_APEI_MEMORY_FAILURE=y
 CONFIG_ACPI_APEI_EINJ=y
 CONFIG_ARM64_CRYPTO=y
-CONFIG_CRYPTO_SHA1_ARM64_CE=y
-CONFIG_CRYPTO_SHA2_ARM64_CE=y
+CONFIG_CRYPTO_SHA1_ARM64_CE=m
+CONFIG_CRYPTO_SHA2_ARM64_CE=m
 CONFIG_CRYPTO_SHA512_ARM64_CE=m
 CONFIG_CRYPTO_SHA3_ARM64=m
 CONFIG_CRYPTO_SM3_ARM64_CE=m
-CONFIG_CRYPTO_GHASH_ARM64_CE=y
+CONFIG_CRYPTO_GHASH_ARM64_CE=m
 CONFIG_CRYPTO_CRCT10DIF_ARM64_CE=m
-CONFIG_CRYPTO_AES_ARM64_CE_CCM=y
-CONFIG_CRYPTO_AES_ARM64_CE_BLK=y
+CONFIG_CRYPTO_AES_ARM64_CE_CCM=m
+CONFIG_CRYPTO_AES_ARM64_CE_BLK=m
 CONFIG_CRYPTO_CHACHA20_NEON=m
 CONFIG_CRYPTO_AES_ARM64_BS=m
 CONFIG_JUMP_LABEL=y
@@ -97,25 +97,16 @@ CONFIG_BLK_DEV_INTEGRITY=y
 CONFIG_KSM=y
 CONFIG_MEMORY_FAILURE=y
 CONFIG_TRANSPARENT_HUGEPAGE=y
-CONFIG_NET=y
 CONFIG_PACKET=y
 CONFIG_UNIX=y
-CONFIG_INET=y
 CONFIG_IP_MULTICAST=y
 CONFIG_IP_PNP=y
 CONFIG_IP_PNP_DHCP=y
 CONFIG_IP_PNP_BOOTP=y
 # CONFIG_IPV6 is not set
-CONFIG_NETWORK_PHY_TIMESTAMPING=y
-CONFIG_NETFILTER=y
-CONFIG_NETFILTER_XT_TARGET_NFQUEUE=y
 CONFIG_IP_SET=y
 CONFIG_IP_NF_IPTABLES=y
 CONFIG_VLAN_8021Q=y
-CONFIG_NET_SCHED=y
-CONFIG_NET_SCH_CBS=y
-CONFIG_NET_SCH_ETF=y
-CONFIG_NET_SCH_MQPRIO=y
 # CONFIG_WIRELESS is not set
 CONFIG_DEVTMPFS=y
 CONFIG_DEVTMPFS_MOUNT=y
@@ -124,68 +115,13 @@ CONFIG_FW_LOADER_USER_HELPER_FALLBACK=y
 # CONFIG_ALLOW_DEV_COREDUMP is not set
 CONFIG_ARM_SCPI_PROTOCOL=y
 CONFIG_EFI_CAPSULE_LOADER=y
-CONFIG_MTD=y
-CONFIG_MTD_BLOCK=y
-CONFIG_MTD_RAW_NAND=y
-CONFIG_MTD_NAND_DENALI_DT=y
-CONFIG_MTD_SPI_NOR=y
-# CONFIG_MTD_SPI_NOR_USE_4K_SECTORS is not set
-# CONFIG_PNP_DEBUG_MESSAGES is not set
-# CONFIG_XEN_BLKDEV_FRONTEND is not set
-CONFIG_SRAM=y
 CONFIG_EEPROM_AT25=m
-CONFIG_ADI_SRAM_MMAP=y
-CONFIG_ADI_SRAM_CONTROLLER=y
-CONFIG_NETDEVICES=y
 CONFIG_MACVLAN=m
 CONFIG_MACVTAP=m
-CONFIG_NETCONSOLE=y
 CONFIG_TUN=y
 CONFIG_VETH=m
-CONFIG_VIRTIO_NET=y
-# CONFIG_NET_VENDOR_ALACRITECH is not set
-# CONFIG_NET_VENDOR_AMAZON is not set
-# CONFIG_NET_VENDOR_AMD is not set
-# CONFIG_NET_VENDOR_AQUANTIA is not set
-# CONFIG_NET_VENDOR_ARC is not set
-# CONFIG_NET_VENDOR_BROADCOM is not set
-# CONFIG_NET_VENDOR_CADENCE is not set
-# CONFIG_NET_VENDOR_CAVIUM is not set
-# CONFIG_NET_VENDOR_CORTINA is not set
-# CONFIG_NET_VENDOR_EZCHIP is not set
-# CONFIG_NET_VENDOR_GOOGLE is not set
-# CONFIG_NET_VENDOR_HISILICON is not set
-# CONFIG_NET_VENDOR_HUAWEI is not set
-# CONFIG_NET_VENDOR_INTEL is not set
-# CONFIG_NET_VENDOR_LITEX is not set
-# CONFIG_NET_VENDOR_MARVELL is not set
-# CONFIG_NET_VENDOR_MELLANOX is not set
-# CONFIG_NET_VENDOR_MICREL is not set
-# CONFIG_NET_VENDOR_MICROCHIP is not set
-# CONFIG_NET_VENDOR_MICROSEMI is not set
-# CONFIG_NET_VENDOR_MICROSOFT is not set
-# CONFIG_NET_VENDOR_NI is not set
-# CONFIG_NET_VENDOR_NATSEMI is not set
-# CONFIG_NET_VENDOR_NETRONOME is not set
-# CONFIG_NET_VENDOR_PENSANDO is not set
-# CONFIG_NET_VENDOR_QUALCOMM is not set
-# CONFIG_NET_VENDOR_RENESAS is not set
-# CONFIG_NET_VENDOR_ROCKER is not set
-# CONFIG_NET_VENDOR_SAMSUNG is not set
-# CONFIG_NET_VENDOR_SEEQ is not set
-# CONFIG_NET_VENDOR_SOLARFLARE is not set
-# CONFIG_NET_VENDOR_SMSC is not set
-# CONFIG_NET_VENDOR_SOCIONEXT is not set
-CONFIG_STMMAC_ETH=y
-# CONFIG_NET_VENDOR_VIA is not set
-# CONFIG_NET_VENDOR_WIZNET is not set
-# CONFIG_NET_VENDOR_XILINX is not set
-# CONFIG_USB_NET_DRIVERS is not set
-# CONFIG_WLAN is not set
-# CONFIG_XEN_NETDEV_FRONTEND is not set
 CONFIG_INPUT_FF_MEMLESS=y
 CONFIG_INPUT_EVDEV=y
-# CONFIG_SERIO_SERPORT is not set
 CONFIG_LEGACY_PTY_COUNT=16
 CONFIG_SERIAL_8250=y
 CONFIG_SERIAL_8250_CONSOLE=y
@@ -205,7 +141,6 @@ CONFIG_IPMI_HANDLER=m
 CONFIG_IPMI_DEVICE_INTERFACE=m
 CONFIG_IPMI_SI=m
 CONFIG_HW_RANDOM=y
-# CONFIG_HW_RANDOM_ARM_SMCCC_TRNG is not set
 CONFIG_HW_RANDOM_ADI=y
 CONFIG_I2C=y
 CONFIG_I2C_CHARDEV=y
@@ -213,7 +148,6 @@ CONFIG_I2C_ADI_TWI=y
 CONFIG_SPI=y
 CONFIG_SPI_CADENCE_QUADSPI=y
 CONFIG_SPI_SPIDEV=y
-# CONFIG_PTP_1588_CLOCK_KVM is not set
 CONFIG_PINCTRL_MCP23S08=y
 CONFIG_PINCTRL_SINGLE=y
 CONFIG_PINCTRL_ADSP_SC5XX=y
@@ -221,59 +155,10 @@ CONFIG_SRUCTRL_ADSP_SC5XX=y
 CONFIG_GPIO_ADI_ADSP_PORT=y
 CONFIG_POWER_RESET_SYSCON=y
 CONFIG_SYSCON_REBOOT_MODE=y
-# CONFIG_POWER_SUPPLY_HWMON is not set
 CONFIG_SENSORS_ARM_SCPI=y
 CONFIG_CPU_THERMAL=y
 CONFIG_THERMAL_EMULATION=y
-CONFIG_WATCHDOG=y
-CONFIG_ADI_WATCHDOG=y
 CONFIG_MFD_HI6421_PMIC=y
-CONFIG_SOUND=y
-CONFIG_SND=y
-CONFIG_SND_SOC=y
-CONFIG_SND_SC5XX_PCM=y
-CONFIG_SND_SC5XX_ADAU1979=y
-CONFIG_SND_SC5XX_ADAU1962=y
-CONFIG_SND_SC5XX_SHARC_ALSA_CARD=y
-CONFIG_SND_SIMPLE_CARD=m
-CONFIG_SND_AUDIO_GRAPH_CARD=m
-# CONFIG_HID is not set
-# CONFIG_USB_HID is not set
-CONFIG_USB=y
-# CONFIG_USB_OTG is not set
-CONFIG_USB_XHCI_HCD=y
-CONFIG_USB_EHCI_HCD=y
-CONFIG_USB_EHCI_HCD_PLATFORM=y
-CONFIG_USB_OHCI_HCD=y
-CONFIG_USB_OHCI_HCD_PLATFORM=y
-CONFIG_USB_MUSB_HDRC=y
-CONFIG_USB_DWC3=y
-CONFIG_USB_DWC2=y
-CONFIG_USB_CHIPIDEA=y
-CONFIG_USB_CHIPIDEA_UDC=y
-CONFIG_USB_CHIPIDEA_HOST=y
-CONFIG_USB_ISP1760=y
-CONFIG_NOP_USB_XCEIV=y
-CONFIG_USB_ULPI=y
-CONFIG_USB_GADGET=y
-CONFIG_TYPEC=m
-CONFIG_MMC=y
-CONFIG_MMC_BLOCK_MINORS=32
-CONFIG_MMC_ARMMMCI=y
-CONFIG_MMC_SDHCI=y
-CONFIG_MMC_SDHCI_PLTFM=y
-CONFIG_MMC_SDHCI_OF_DWCMSHC=y
-CONFIG_MMC_DW=y
-CONFIG_MMC_CQHCI=y
-CONFIG_NEW_LEDS=y
-CONFIG_LEDS_CLASS=y
-CONFIG_LEDS_GPIO=y
-CONFIG_LEDS_SYSCON=y
-CONFIG_LEDS_TRIGGERS=y
-CONFIG_LEDS_TRIGGER_HEARTBEAT=y
-CONFIG_LEDS_TRIGGER_CPU=y
-CONFIG_LEDS_TRIGGER_DEFAULT_ON=y
-CONFIG_LEDS_TRIGGER_PANIC=y
 CONFIG_RTC_CLASS=y
 CONFIG_DMADEVICES=y
 CONFIG_ADI_DMA=y
@@ -282,8 +167,6 @@ CONFIG_PL330_DMA=y
 CONFIG_VFIO=y
 CONFIG_VIRTIO_BALLOON=y
 CONFIG_VIRTIO_MMIO=y
-# CONFIG_VHOST_MENU is not set
-# CONFIG_SURFACE_PLATFORMS is not set
 CONFIG_COMMON_CLK_ADI_SC598=y
 CONFIG_COMMON_CLK_SCPI=y
 CONFIG_HWSPINLOCK=y
@@ -291,78 +174,5 @@ CONFIG_ARM_MHU=y
 CONFIG_PLATFORM_MHU=y
 CONFIG_ARM_SMMU=y
 CONFIG_ARM_SMMU_V3=y
-CONFIG_REMOTEPROC=y
-CONFIG_ADI_REMOTEPROC=y
-CONFIG_RPMSG_CHAR=y
-CONFIG_RPMSG_QCOM_GLINK_RPM=y
-CONFIG_RPMSG_VIRTIO=y
-CONFIG_PM_DEVFREQ=y
-CONFIG_DEVFREQ_GOV_SIMPLE_ONDEMAND=y
-CONFIG_IIO=y
-CONFIG_ADI_HADC=y
 CONFIG_ADI_ADSP_IRQ=y
-CONFIG_PHY_XGENE=y
-CONFIG_PHY_QCOM_USB_HS=y
-CONFIG_HISI_PMU=y
-CONFIG_EXT2_FS=y
-CONFIG_EXT4_FS=y
-CONFIG_EXT4_FS_POSIX_ACL=y
-CONFIG_FANOTIFY=y
-CONFIG_FANOTIFY_ACCESS_PERMISSIONS=y
-CONFIG_QUOTA=y
-CONFIG_AUTOFS4_FS=y
-CONFIG_VFAT_FS=y
-CONFIG_TMPFS=y
-CONFIG_TMPFS_POSIX_ACL=y
-CONFIG_HUGETLBFS=y
-CONFIG_CONFIGFS_FS=y
-CONFIG_EFIVAR_FS=y
-CONFIG_JFFS2_FS=y
-CONFIG_NFS_FS=y
-CONFIG_NFS_V3_ACL=y
-CONFIG_NFS_V4=y
-CONFIG_NFS_V4_1=y
-CONFIG_NFS_V4_2=y
-CONFIG_ROOT_NFS=y
-CONFIG_NLS_CODEPAGE_437=y
-CONFIG_NLS_ISO8859_1=y
-CONFIG_SECURITY=y
-CONFIG_SECURITYFS=y
-CONFIG_CRYPTO_TEST=m
-CONFIG_CRYPTO_RSA=y
-CONFIG_CRYPTO_ECDH=m
-CONFIG_CRYPTO_CCM=m
-CONFIG_CRYPTO_GCM=m
-CONFIG_CRYPTO_ECHAINIV=y
-CONFIG_CRYPTO_ECB=m
-CONFIG_CRYPTO_CMAC=m
-CONFIG_CRYPTO_ANSI_CPRNG=y
-CONFIG_CRYPTO_DEV_ADI_CRC=y
-CONFIG_CRYPTO_DEV_ADI_HASH=y
-CONFIG_CRYPTO_DEV_ADI_SKCIPHER=y
-CONFIG_ASYMMETRIC_KEY_TYPE=y
-CONFIG_ASYMMETRIC_PUBLIC_KEY_SUBTYPE=y
-CONFIG_X509_CERTIFICATE_PARSER=y
-CONFIG_PKCS7_MESSAGE_PARSER=y
-CONFIG_SYSTEM_TRUSTED_KEYRING=y
-CONFIG_CRC_T10DIF=y
-CONFIG_CRC_ITU_T=y
-CONFIG_CRC7=y
-CONFIG_XZ_DEC=y
-CONFIG_IRQ_POLL=y
-CONFIG_PRINTK_TIME=y
-CONFIG_MAGIC_SYSRQ=y
-CONFIG_DEBUG_MEMORY_INIT=y
-CONFIG_BLK_DEV_IO_TRACE=y
-# CONFIG_STRICT_DEVMEM is not set
-CONFIG_MEMTEST=y
-CONFIG_BLK_DEV_INTEGRITY_T10=y
-CONFIG_SCSI_MOD=y
-CONFIG_SCSI_COMMON=y
-CONFIG_SCSI=y
-CONFIG_SCSI_DMA=y
-CONFIG_SCSI_PROC_FS=y
-CONFIG_BLK_DEV_SD=y
-CONFIG_BLK_DEV_BSG=y
-CONFIG_USB_STORAGE=y
 CONFIG_SG_POOL=y
-- 
2.34.1


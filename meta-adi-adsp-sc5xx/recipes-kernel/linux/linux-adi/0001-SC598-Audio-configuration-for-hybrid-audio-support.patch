From 3209f28b8f9e02e896a20ab60103f7de2c588890 Mon Sep 17 00:00:00 2001
From: Arturs Artamonovs <Arturs.Artamonovs@analog.com>
Date: Tue, 20 May 2025 13:53:51 +0100
Subject: [PATCH] [PATCH 1/2] SC598 Audio configuration for hybrid audio
 support

Signed-off-by: Arturs Artamonovs <Arturs.Artamonovs@analog.com>
---
 arch/arm64/boot/dts/adi/sc598-som.dtsi | 23 +++++++++++++-------
 arch/arm64/boot/dts/adi/sc59x-64.dtsi  | 29 +++++++++++++++++++++++++-
 2 files changed, 43 insertions(+), 9 deletions(-)

diff --git a/arch/arm64/boot/dts/adi/sc598-som.dtsi b/arch/arm64/boot/dts/adi/sc598-som.dtsi
index 47060d5bce61..3cc69b7aa2da 100644
--- a/arch/arm64/boot/dts/adi/sc598-som.dtsi
+++ b/arch/arm64/boot/dts/adi/sc598-som.dtsi
@@ -28,10 +28,10 @@ memory@20040000 {
 	};
 
 	reserved-memory {
-		sram1_res: sram1-reserved@20040000 {
-			compatible = "adi,sram-access";
-			reg = <0x20040000 0x40000>;
-		};
+		//sram1_res: sram1-reserved@20040000 {
+//			compatible = "adi,sram-access";
+//			reg = <0x20040000 0x40000>;
+//		};
 
 		vdev0vrings: vdev0vring0@20080000 {
 			reg = <0x20080000 0x4000>;
@@ -56,12 +56,15 @@ vdev1buffer: vdev0buffer@200A8000 {
 		};
 	};
 
-	sram1_mmap: sram-mmap@0 {
-		compatible = "adi,sram-mmap";
-		memory-region = <&sram1_res>;
-		status = "okay";
+	sram2: sram-reserved@200C8000 {
+		compatible = "mmio-sram";
+		#address-cells = <1>;
+		#size-cells = <1>;
+		reg = <0x200C8000 0x138000>;
+		ranges = <0 0x200C8000 0x138000>; /*1248KiB*/
 	};
 
+
 	scb {
 		sharc0: core1-rproc@28240000 {
 			compatible = "adi,remoteproc";
@@ -357,6 +360,10 @@ &usb0 {
 	status = "okay";
 };
 
+&sram_mmap {
+	status = "okay";
+};
+
 &pinctrl0 {
 	uart0_default: uart0_default_pins {
 		pins {
diff --git a/arch/arm64/boot/dts/adi/sc59x-64.dtsi b/arch/arm64/boot/dts/adi/sc59x-64.dtsi
index f3f05804e720..72b3ad430f28 100644
--- a/arch/arm64/boot/dts/adi/sc59x-64.dtsi
+++ b/arch/arm64/boot/dts/adi/sc59x-64.dtsi
@@ -77,6 +77,22 @@ gic: interrupt-controller@31200000 {
 		      <0x31240000 0x40000>; /* GICR */
 	};
 
+	sram0: sram-icc@20025000 {
+		compatible = "mmio-sram";
+		#address-cells = <1>;
+		#size-cells = <1>;
+		reg = <0x20025000 0x1B000>;
+		ranges = <0 0x20025000 0x1B000>; /*108KiB*/
+	};
+
+	sram1: sram-reserved@20040000 {
+		compatible = "mmio-sram";
+		#address-cells = <1>;
+		#size-cells = <1>;
+		reg = <0x20040000 0x40000>;
+		ranges = <0 0x20040000 0x40000>; /*256KiB*/
+	};
+
 	timer {
 		compatible = "arm,armv8-timer";
 		interrupts = <GIC_PPI 13 IRQ_TYPE_LEVEL_LOW>, /* Physical Secure */
@@ -195,6 +211,11 @@ rsc_tbl1: rsc_tbl0@20000400 {
 			no-map;
 		};
 
+		sram_B1_unused@20000800 {
+			reg = <0x20000800 0x4800>; /*18KiB*/
+			no-map;
+		};
+
 		sharc_internal_icc@20005000 {
 			reg = <0x20005000 0x20000>; /*128KiB*/
 			no-map;
@@ -222,11 +243,17 @@ dmc_pmu: dmc-pmu@31070000 {
 		sram-controller@31080000 {
 			compatible = "adi,sram-controller";
 			reg = <0x31080000 0x100>;
-			/* adi,sram = <&sram0>, <&sram1>; */
+			adi,sram = <&sram0>, <&sram1>;
 			interrupts = <GIC_SPI 10 IRQ_TYPE_LEVEL_HIGH>;
 			status = "disabled";
 		};
 
+		sram_mmap: sram-mmap@0 {
+			compatible = "adi,sram-mmap";
+			memory-region = <&sram1>;
+			status = "disabled";
+		};
+
 		gptimer_counter: gptimer-counters@0 {
 			compatible = "adi,gptimer-counter";
 			status = "okay";
-- 
2.34.1

